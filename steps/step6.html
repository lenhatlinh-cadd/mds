<h2>Bước 5: Cân bằng hệ thống (Equilibration – NVT)</h2>

<p>Sau khi đã tối ưu năng lượng, chúng ta có một cấu trúc khởi đầu hợp lý về hình học và định hướng dung môi. Tuy nhiên, để bắt đầu mô phỏng động lực học phân tử (MD) thực sự, cần phải <b>cân bằng dung môi và ion</b> xung quanh protein. Nếu bỏ qua bước này và chạy ngay động lực học không hạn chế, hệ thống có thể sụp đổ vì dung môi mới chỉ tối ưu nội tại, chưa thích ứng với phân tử hòa tan (protein).</p>

<p>Ở giai đoạn cân bằng, chúng ta sẽ đưa hệ thống về nhiệt độ mô phỏng mong muốn và sau đó áp suất sẽ được điều chỉnh để đạt mật độ phù hợp.</p>

<h3>Sử dụng file posre.itp</h3>

<p>Bạn còn nhớ file <code>posre.itp</code> được tạo bởi <code>pdb2gmx</code> không? Chúng ta sẽ dùng nó ngay bây giờ. File này áp dụng lực hạn chế vị trí lên các nguyên tử nặng (tức là trừ hydro) của protein. Các nguyên tử vẫn có thể di chuyển, nhưng cần vượt qua một “rào cản năng lượng” đáng kể. Ý nghĩa của việc này là giúp dung môi được cân bằng xung quanh protein, trong khi cấu trúc protein không bị biến dạng nhiều. Vị trí gốc của ràng buộc được cung cấp qua file tọa độ đi kèm tùy chọn <code>-r</code> trong lệnh <code>grompp</code>.</p>

<h3>Quá trình NVT</h3>

<p>Cân bằng thường được thực hiện qua hai pha. Pha đầu là <b>NVT ensemble</b> (giữ cố định số hạt, thể tích và nhiệt độ). Trong giai đoạn này, nhiệt độ hệ thống sẽ dần ổn định ở giá trị mong muốn. Thông thường, 50–100 ps là đủ; trong hướng dẫn này ta sẽ thực hiện 100 ps.</p>

<p>Thời gian chạy phụ thuộc vào phần cứng: trên CPU đa nhân có thể mất gần 1 giờ, còn nếu dùng GPU thông dụng, chỉ mất 1–2 phút.</p>

<h3>Chạy NVT bằng grompp và mdrun</h3>

<div class="code-block">
<pre>
gmx grompp -f inputs/nvt.mdp -c em.gro -r em.gro -p topol.top -o nvt.tpr
gmx mdrun -deffnm nvt
</pre>
</div>

<p>Một số thông số quan trọng trong file <code>nvt.mdp</code>:</p>
<ul>
  <li><code>gen_vel = yes</code>: tạo vận tốc ban đầu ngẫu nhiên. Có thể thay đổi <code>gen_seed</code> để khởi tạo nhiều mô phỏng khác nhau từ cùng cấu trúc ban đầu.</li>
  <li><code>tcoupl = V-rescale</code>: thuật toán thermostat V-rescale (Bussi et al.).</li>
  <li><code>pcoupl = no</code>: chưa áp dụng điều chỉnh áp suất trong giai đoạn này.</li>
</ul>

<h3>Phân tích nhiệt độ</h3>

<p>Để kiểm tra sự tiến triển nhiệt độ, dùng lệnh:</p>

<div class="code-block">
<pre>
gmx energy -f nvt.edr -o temperature.xvg
</pre>
</div>

<p>Khi được hỏi, nhập <b>16 0</b> để chọn nhiệt độ (Temperature) và kết thúc. File <code>temperature.xvg</code> sẽ được tạo, có thể mở bằng Xmgrace để vẽ đồ thị.</p>

<p>Kết quả mong đợi: nhiệt độ hệ thống nhanh chóng đạt 298 K và duy trì ổn định trong suốt quá trình NVT. Với hệ đơn giản này, chỉ 50 ps cũng có thể đủ, nhưng chúng ta thực hiện 100 ps để chắc chắn.</p>
