<h2>Step 6: Cân bằng NPT</h2>

<p>Trong bước trước (NVT), hệ thống đã ổn định về <b>nhiệt độ</b>. Tuy nhiên, trước khi thu thập dữ liệu, chúng ta cũng cần ổn định <b>áp suất</b> (và do đó cả <b>mật độ</b> của hệ). Quá trình này được gọi là cân bằng trong tập hợp <b>NPT</b>, nơi số hạt (N), áp suất (P) và nhiệt độ (T) được giữ không đổi. Tập hợp này còn gọi là <i>đẳng nhiệt - đẳng áp</i> và gần giống nhất với điều kiện thí nghiệm thực tế.</p>

<p>Tập tin <code>.mdp</code> dùng cho quá trình cân bằng NPT 500 ps có thể tải tại đây. Nó không khác nhiều so với tập tin tham số của bước NVT, chỉ khác ở chỗ bước này thường cần thời gian dài hơn, vì áp suất mất nhiều thời gian để ổn định hơn nhiệt độ. Trong phần tham số có bổ sung thêm <b>pressure coupling</b> bằng <i>C-rescale barostat</i>.</p>

<p>Một vài thay đổi quan trọng:</p>
<ul>
  <li><code>continuation = yes</code>: Tiếp tục mô phỏng từ bước NVT.</li>
  <li><code>gen_vel = no</code>: Vận tốc được lấy từ kết quả của NVT trước đó.</li>
</ul>

<p>Chúng ta sẽ gọi <code>grompp</code> và <code>mdrun</code> giống như ở bước NVT. Lưu ý thêm cờ <code>-t</code> để đưa vào file checkpoint từ NVT (<code>nvt.cpt</code>), nhằm giữ lại vận tốc đã sinh ra ở bước trước. File tọa độ (<code>-c</code>) cũng chính là kết quả cuối cùng của NVT:</p>

<div class="code-block">
<pre>
gmx grompp -f inputs/npt.mdp -c nvt.gro -r nvt.gro -t nvt.cpt -p topol.top -o npt.tpr

gmx mdrun -deffnm npt
</pre>
</div>

<h3>Phân tích áp suất</h3>
<p>Sử dụng lệnh <code>gmx energy</code> để xem sự thay đổi áp suất theo thời gian:</p>

<div class="code-block">
<pre>
gmx energy -f npt.edr -o pressure.xvg
</pre>
</div>

<p>Nhập <code>17 0</code> tại dấu nhắc để chọn áp suất. Kết quả thường cho thấy áp suất dao động khá mạnh trong khoảng 100 ps, điều này là bình thường. Giá trị trung bình của hệ ở đây là <b>-3 ± 11 bar</b>, so với áp suất tham chiếu là 1 bar. Vì áp suất dao động nhiều trong mô phỏng MD, nên về mặt thống kê, kết quả này vẫn phù hợp.</p>

<h3>Phân tích mật độ</h3>
<p>Tiếp theo, ta phân tích mật độ bằng lệnh:</p>

<div class="code-block">
<pre>
gmx energy -f npt.edr -o density.xvg
</pre>
</div>

<p>Nhập <code>23 0</code> để chọn mật độ. Kết quả trung bình trong 500 ps là <b>1025,3 ± 0,5 kg/m³</b>, cao hơn so với giá trị thực nghiệm (1000 kg/m³) và so với mật độ dự đoán của mô hình TIP3P (986 kg/m³). Điều này hợp lý, bởi vì hệ của chúng ta không chỉ chứa nước tinh khiết, mà còn có protein và ion, nên không thể khớp hoàn toàn. Quan trọng là mật độ đã ổn định trong suốt quá trình cân bằng.</p>

<p><i>Lưu ý:</i> Kết quả mật độ của bạn có thể khác so với ví dụ này. Các giá trị liên quan đến áp suất thường hội tụ chậm và mô phỏng MD luôn có tính ngẫu nhiên, vì vậy đừng lo lắng nếu không tái tạo được con số y hệt.</p>
